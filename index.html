<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Information Hub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/Roomfolio/manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>

    <div id="LoginView" class="view-section active-view">
        <div class="login-container">
            <header class="view-header" style="text-align: center; border-bottom: none; margin-bottom: 20px;">
                <h1><i class="fas fa-building"></i> Welcome to Roomfolio</h1>
            </header>
            <form id="loginForm">
                <p class="data-management-description" style="text-align: center;">Please sign in to continue.</p>
                <div class="input-group">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" name="loginEmail" required>
                </div>
                <div class="input-group">
                    <label for="loginPassword">Password:</label>
                    <input type="password" id="loginPassword" name="loginPassword" required>
                </div>
                <button type="submit" class="action-button primary-button" style="width: 100%;">Sign In</button>
                <p id="loginFeedback" class="feedback"></p>
                <p style="text-align:center; margin-top:15px;"><a href="#" id="switchToRegister">Need an account? Request Access</a></p>
            </form>
        </div>
    </div>

    <div id="RegisterView" class="view-section" style="display: none;">
        <div class="login-container">
            <header class="view-header" style="text-align: center; border-bottom: none; margin-bottom: 20px;">
                <h1><i class="fas fa-user-plus"></i> Request an Account</h1>
            </header>
            <form id="registerForm">
                <p class="data-management-description" style="text-align: center;">An account is required. All requests must be approved by an administrator.</p>
                <div class="input-group">
                    <label for="registerEmail">Email (must be @muskingum.edu):</label>
                    <input type="email" id="registerEmail" name="registerEmail" required>
                </div>
                <div class="input-group">
                    <label for="registerPassword">Password:</label>
                    <input type="password" id="registerPassword" name="registerPassword" required>
                </div>
                <button type="submit" class="action-button primary-button" style="width: 100%;">Submit Request</button>
                <p id="registerFeedback" class="feedback"></p>
                <p style="text-align:center; margin-top:15px;"><a href="#" id="switchToLogin">Already have an account? Sign In</a></p>
            </form>
        </div>
    </div>


    <div class="app-container" id="AppContainer" style="display: none;">
        <nav class="main-nav">
            <div class="nav-logo">
                <i class="fas fa-building"></i> Roomfolio
            </div>
            <button class="hamburger" id="hamburger-menu" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
            <div class="nav-links-container" id="nav-links-container">
                <ul>
                    <li><a href="#" id="navViewRooms" class="nav-link active-link"><i class="fas fa-list-alt"></i> View Rooms</a></li>
                    <li><a href="#" id="navAddRoom" class="nav-link"><i class="fas fa-plus-circle"></i> Add Room</a></li>
                    <li><a href="#" id="navFilter" class="nav-link"><i class="fas fa-filter"></i> Filter Rooms</a></li>
                    <li><a href="#" id="navData" class="nav-link"><i class="fas fa-database"></i> Data Management</a></li>
                    <li><a href="#" id="navAdmin" class="nav-link" style="display: none;"><i class="fas fa-user-shield"></i> Admin</a></li>
                </ul>
                 <div class="user-status">
                    <span id="userEmailDisplay"></span>
                    <button id="signOutBtn" class="action-button danger-button" style="display: none;"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
                </div>
            </div>
        </nav>

        <main class="content-area">
            <div id="AddRoomView" class="view-section">
                <header class="view-header">
                    <h1 id="addEditRoomTitle"><i class="fas fa-pencil-alt"></i> Add New Room Information</h1>
                </header>
                <form id="roomForm">
                    <input type="hidden" id="editingRoomId" name="editingRoomId">
                    <input type="hidden" id="isResolvingAttemptedData" name="isResolvingAttemptedData" value="false">
                    
                    <section class="form-section">
                        <h2><i class="fas fa-id-card"></i> 1. Identification</h2>
                        <div class="input-group">
                            <label for="buildingName">Building Name:</label>
                            <select id="buildingName" name="buildingName" required>
                                <option value="">-- Select Building --</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="roomIdentifier">Room Identifier:</label>
                            <input type="text" id="roomIdentifier" name="roomIdentifier" required placeholder="e.g., 203A or 2nd Floor East Hallway">
                            <small>For hallways, please use cardinal directions (e.g., "North Corridor").</small>
                        </div>
                        <div class="input-group">
                            <label for="roomPurpose">Purpose:</label>
                            <select id="roomPurpose" name="roomPurpose">
                                <option value="Lab">Lab</option>
                                <option value="Classroom">Classroom</option>
                                <option value="Specialty">Specialty</option>
                                <option value="Office">Office</option>
                                <option value="Storage">Storage</option>
                                <option value="Common">Common</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="roomPurposeOther" class="visually-hidden">Specify other room purpose</label>
                            <input type="text" id="roomPurposeOther" name="roomPurposeOther" class="conditional-other" placeholder="Specify other room purpose">
                        </div>
                    </section>

                    <section class="form-section">
                        <h2><i class="fas fa-ruler-combined"></i> 2. Structural Components</h2>
                        <div class="input-group">
                            <label for="walls">Walls Type:</label>
                            <select id="walls" name="walls">
                                <option value="Drywall">Drywall</option>
                                <option value="Plaster">Plaster</option>
                                <option value="Bricks">Bricks</option>
                                <option value="Blocks">Blocks</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="wallsOther" class="visually-hidden">Specify other wall type</label>
                            <input type="text" id="wallsOther" name="wallsOther" class="conditional-other" placeholder="Specify other wall type">
                        </div>
                        <div class="input-group">
                            <label for="wallsCondition">Walls Condition:</label>
                            <select id="wallsCondition" name="wallsCondition">
                                <option value="1 - Excellent">1 - Excellent</option>
                                <option value="2 - Good">2 - Good</option>
                                <option value="3 - Fair">3 - Fair</option>
                                <option value="4 - Poor">4 - Poor</option>
                                <option value="5 - Needs Replacement">5 - Needs Replacement</option>
                            </select>
                            <label for="wallsConditionComment" class="visually-hidden">Walls Condition Comments</label>
                            <textarea id="wallsConditionComment" name="wallsConditionComment" rows="2" placeholder="Optional comments for walls condition..."></textarea>
                        </div>

                        <div class="input-group">
                            <label for="floorType">Floor Type:</label>
                            <select id="floorType" name="floorType">
                                <option value="Carpet">Carpet</option>
                                <option value="Tile">Tile</option>
                                <option value="VCT">VCT</option>
                                <option value="Concrete">Concrete</option>
                                <option value="Wood">Wood</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="floorTypeOther" class="visually-hidden">Specify other floor type</label>
                            <input type="text" id="floorTypeOther" name="floorTypeOther" class="conditional-other" placeholder="Specify other floor type">
                        </div>
                        <div id="floorTileOptions" class="conditional-section" style="display:none;">
                            <fieldset class="sub-group">
                                <legend class="group-label" id="floorTileSizeLabel">Tile Size (for Floor Tile):</legend>
                                <div class="radio-group" role="radiogroup" aria-labelledby="floorTileSizeLabel">
                                    <label><input type="radio" name="floorTileSize" value="9x9"> 9" x 9"</label>
                                    <label><input type="radio" name="floorTileSize" value="12x12" checked> 12" x 12"</label>
                                    <label><input type="radio" name="floorTileSize" value="18x18"> 18" x 18"</label>
                                    <label><input type="radio" name="floorTileSize" value="24x24"> 24" x 24"</label>
                                    <label><input type="radio" name="floorTileSize" value="Other"> Other Size</label>
                                </div>
                                <label for="floorTileSizeOther" class="visually-hidden">Specify other floor tile size</label>
                                <input type="text" id="floorTileSizeOther" name="floorTileSizeOther" class="conditional-other" placeholder="Specify other tile size" style="display:none;">
                            </fieldset>
                        </div>
                        <div class="input-group">
                            <label for="floorCondition">Floor Condition:</label>
                            <select id="floorCondition" name="floorCondition">
                                <option value="1 - Excellent">1 - Excellent</option>
                                <option value="2 - Good">2 - Good</option>
                                <option value="3 - Fair">3 - Fair</option>
                                <option value="4 - Poor">4 - Poor</option>
                                <option value="5 - Needs Replacement">5 - Needs Replacement</option>
                            </select>
                            <label for="floorConditionComment" class="visually-hidden">Floor Condition Comments</label>
                            <textarea id="floorConditionComment" name="floorConditionComment" rows="2" placeholder="Optional comments for floor condition..."></textarea>
                        </div>

                        <div class="input-group">
                            <label for="ceilingType">Ceiling Type:</label>
                            <select id="ceilingType" name="ceilingType">
                                <option value="Drop Ceiling">Drop Ceiling</option>
                                <option value="Hard Ceiling">Hard Ceiling</option>
                                <option value="Plaster">Plaster</option>
                                <option value="None">None</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="ceilingTypeOther" class="visually-hidden">Specify other ceiling type</label>
                            <input type="text" id="ceilingTypeOther" name="ceilingTypeOther" class="conditional-other" placeholder="Specify other ceiling type">
                        </div>
                        <div class="input-group">
                            <label for="ceilingCondition">Ceiling Condition:</label>
                            <select id="ceilingCondition" name="ceilingCondition">
                                <option value="1 - Excellent">1 - Excellent</option>
                                <option value="2 - Good">2 - Good</option>
                                <option value="3 - Fair">3 - Fair</option>
                                <option value="4 - Poor">4 - Poor</option>
                                <option value="5 - Needs Replacement">5 - Needs Replacement</option>
                            </select>
                            <label for="ceilingConditionComment" class="visually-hidden">Ceiling Condition Comments</label>
                            <textarea id="ceilingConditionComment" name="ceilingConditionComment" rows="2" placeholder="Optional comments for ceiling condition..."></textarea>
                        </div>
                        
                        <div id="doorsContainer"></div>
                        <button type="button" id="addDoorBtn" class="action-button secondary-button"><i class="fas fa-plus"></i> Add Door</button>
                    </section>

                    <section class="form-section">
                        <h2><i class="fas fa-cogs"></i> 3. Systems & Utilities</h2>
                        <fieldset class="input-group">
                            <legend class="group-label">Light Fixtures</legend>
                            <div id="lightFixturesContainer"></div>
                            <button type="button" id="addLightFixtureBtn" class="action-button secondary-button" style="margin-top: 5px; font-size: 0.9em; padding: 0.5em 1em;"><i class="fas fa-plus"></i> Add Light Fixture Type</button>
                        </fieldset>
                        <fieldset class="input-group">
                            <legend class="group-label" id="otherFixturesGroupLabel">Other Fixtures (Specify quantity if present)</legend>
                            <div class="other-fixtures-grid" role="group" aria-labelledby="otherFixturesGroupLabel">
                                <div class="fixture-item-group"><label for="otherFixtureSinkPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureSinkPresent" name="otherFixturePresent" value="Sink/Faucet" class="fixture-present-checkbox"> Sink/Faucet</label><input type="number" id="otherFixtureSinkCount" name="otherFixtureSinkCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureShowerPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureShowerPresent" name="otherFixturePresent" value="Shower" class="fixture-present-checkbox"> Shower</label><input type="number" id="otherFixtureShowerCount" name="otherFixtureShowerCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureToiletPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureToiletPresent" name="otherFixturePresent" value="Toilet" class="fixture-present-checkbox"> Toilet</label><input type="number" id="otherFixtureToiletCount" name="otherFixtureToiletCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureGasPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureGasPresent" name="otherFixturePresent" value="Gas Supply" class="fixture-present-checkbox"> Gas Supply</label><input type="number" id="otherFixtureGasCount" name="otherFixtureGasCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureCompAirPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureCompAirPresent" name="otherFixturePresent" value="Compressed Air" class="fixture-present-checkbox"> Compressed Air</label><input type="number" id="otherFixtureCompAirCount" name="otherFixtureCompAirCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureSuctionPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureSuctionPresent" name="otherFixturePresent" value="Suction Air" class="fixture-present-checkbox"> Suction Air</label><input type="number" id="otherFixtureSuctionCount" name="otherFixtureSuctionCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group"><label for="otherFixtureLabHoodPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixtureLabHoodPresent" name="otherFixturePresent" value="Lab Hood" class="fixture-present-checkbox"> Lab Hood</label><input type="number" id="otherFixtureLabHoodCount" name="otherFixtureLabHoodCount" class="fixture-count-input" placeholder="Qty" min="1" style="display:none;"></div>
                                <div class="fixture-item-group fixture-item-group-other"><label for="otherFixturesOtherPresent" class="fixture-checkbox-label"><input type="checkbox" id="otherFixturesOtherPresent" name="otherFixturePresent" value="Other" class="fixture-present-checkbox other-checkbox"> Other Fixture</label><div class="other-details-container" style="display:none;"><input type="text" id="otherFixturesSpecifyText" name="otherFixturesSpecify" class="conditional-other" placeholder="Specify other type"><input type="number" id="otherFixturesOtherCount" name="otherFixturesOtherCount" class="fixture-count-input" placeholder="Qty" min="1"></div></div>
                            </div>
                        </fieldset>
                        <div class="input-group">
                            <label for="heatingCooling">Heating/Cooling Type:</label>
                            <select id="heatingCooling" name="heatingCooling">
                                <option value="Forced Air">Forced Air</option>
                                <option value="Hot Water Radiators/Baseboard">Hot Water Radiators/Baseboard</option>
                                <option value="Steam Radiators">Steam Radiators</option>
                                <option value="Cold Water (chilled beams)">Cold Water (chilled beams)</option>
                                <option value="No Air Conditioning">No Air Conditioning</option>
                                <option value="No Heating">No Heating</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="heatingCoolingOther" class="visually-hidden">Specify other heating/cooling</label>
                            <input type="text" id="heatingCoolingOther" name="heatingCoolingOther" class="conditional-other" placeholder="Specify other heating/cooling">
                        </div>
                        <fieldset class="input-group">
                            <legend class="visually-hidden">Technology types</legend>
                            <div class="checkbox-group" role="group" aria-label="Technology types">
                                <label for="techProjector"><input type="checkbox" id="techProjector" name="technology" value="Projector"> Projector</label>
                                <label for="techTV"><input type="checkbox" id="techTV" name="technology" value="Wall-mount TV"> Wall-mount TV</label>
                                <label for="techSound"><input type="checkbox" id="techSound" name="technology" value="Sound System"> Sound System</label>
                                <label for="techInteractiveWB"><input type="checkbox" id="techInteractiveWB" name="technology" value="Interactive Whiteboard/Smartboard"> Interactive WB/Smartboard</label>
                                <label for="techPrinters"><input type="checkbox" id="techPrinters" name="technology" value="Printers"> Printers</label>
                                <label for="techComputerStations"><input type="checkbox" id="techComputerStations" name="technology" value="Computer Station(s)"> Computer Station(s)</label>
                                <div class="other-field-wrapper">
                                    <label for="technologyOtherCheckbox"><input type="checkbox" id="technologyOtherCheckbox" name="technology" value="Other" class="other-checkbox"> Other</label>
                                    <input type="text" id="technologyOtherSpecifyText" name="technologyOtherSpecify" class="conditional-other inline-other" placeholder="Specify other" aria-label="Specify other technology">
                                </div>
                            </div>
                        </fieldset>
                    </section>

                    <section class="form-section">
                        <h2><i class="fas fa-couch"></i> 4. Furnishings & Equipment</h2>
                        <fieldset class="input-group">
                            <legend class="visually-hidden">Furniture types</legend>
                            <div class="checkbox-group" role="group" aria-label="Furniture types">
                                <label for="furnitureTables"><input type="checkbox" id="furnitureTables" name="furniture" value="Tables"> Tables</label>
                                <label for="furnitureChairs"><input type="checkbox" id="furnitureChairs" name="furniture" value="Chairs"> Chairs</label>
                                <label for="furnitureTablets"><input type="checkbox" id="furnitureTablets" name="furniture" value="Tablets"> Tablets (arm chairs)</label>
                                <label for="furnitureLecterns"><input type="checkbox" id="furnitureLecterns" name="furniture" value="Lecterns"> Lecterns</label>
                                <label for="furnitureShelving"><input type="checkbox" id="furnitureShelving" name="furniture" value="Shelving"> Shelving</label>
                                <div class="other-field-wrapper">
                                    <label for="furnitureSpecialtyEquipCheckbox"><input type="checkbox" id="furnitureSpecialtyEquipCheckbox" name="furniture" value="Specialty Equipment" class="other-checkbox"> Specialty Eq.</label>
                                    <input type="text" id="furnitureSpecialtySpecifyText" name="furnitureSpecialtySpecify" class="conditional-other inline-other" placeholder="Specify specialty" aria-label="Specify specialty equipment">
                                </div>
                                <label for="furnitureWhiteboard"><input type="checkbox" id="furnitureWhiteboard" name="furniture" value="Whiteboard"> Whiteboard</label>
                                <label for="furnitureChalkboard"><input type="checkbox" id="furnitureChalkboard" name="furniture" value="Chalkboard"> Chalkboard</label>
                                <div class="other-field-wrapper">
                                    <label for="furnitureOtherCheckbox"><input type="checkbox" id="furnitureOtherCheckbox" name="furniture" value="Other" class="other-checkbox"> Other</label>
                                    <input type="text" id="furnitureOtherSpecifyText" name="furnitureOtherSpecify" class="conditional-other inline-other" placeholder="Specify other" aria-label="Specify other furniture">
                                </div>
                            </div>
                        </fieldset>
                        <div class="input-group">
                            <label for="furnitureCondition">Furniture Condition:</label>
                            <select id="furnitureCondition" name="furnitureCondition">
                                <option value="1 - Excellent">1 - Excellent</option>
                                <option value="2 - Good">2 - Good</option>
                                <option value="3 - Fair">3 - Fair</option>
                                <option value="4 - Poor">4 - Poor</option>
                                <option value="5 - Needs Replacement">5 - Needs Replacement</option>
                            </select>
                            <label for="furnitureConditionComment" class="visually-hidden">Furniture Condition Comments</label>
                            <textarea id="furnitureConditionComment" name="furnitureConditionComment" rows="2" placeholder="Optional comments for furniture condition..."></textarea>
                        </div>
                    </section>
                    
                    <section class="form-section">
                        <h2><i class="fas fa-shield-alt"></i> 5. Safety & Compliance</h2>
                        <div class="input-group">
                            <label for="smokeDetectors">Number of Smoke Detectors:</label>
                            <input type="number" id="smokeDetectors" name="smokeDetectors" min="0" placeholder="e.g., 1">
                        </div>
                        <div class="input-group">
                            <label for="maxOccupancy">Maximum Room Occupancy:</label>
                            <input type="number" id="maxOccupancy" name="maxOccupancy" min="0" placeholder="e.g., 25">
                        </div>
                        <div id="dropCeilingOptions" class="conditional-section">
                            <fieldset class="sub-group">
                               <legend class="group-label" id="ceilingAsbestosLabel">Asbestos in Ceiling? (for Drop Ceiling)</legend>
                               <div class="radio-group" role="radiogroup" aria-labelledby="ceilingAsbestosLabel">
                                   <label><input type="radio" name="ceilingAsbestos" value="Yes"> Yes</label>
                                   <label><input type="radio" name="ceilingAsbestos" value="No" checked> No</label>
                                   <label><input type="radio" name="ceilingAsbestos" value="Unknown"> Unknown</label>
                               </div>
                           </fieldset>
                       </div>
                    </section>

                    <section class="form-section">
                        <h2><i class="fas fa-clipboard-check"></i> 6. Overall Room Condition</h2>
                        <div class="input-group">
                            <label for="overallCondition">Overall Room Condition:</label>
                            <select id="overallCondition" name="overallCondition">
                                <option value="">N/A - Calculate Automatically</option>
                                <option value="1 - Excellent">1 - Excellent</option>
                                <option value="2 - Good">2 - Good</option>
                                <option value="3 - Fair">3 - Fair</option>
                                <option value="4 - Poor">4 - Poor</option>
                                <option value="5 - Needs Replacement">5 - Needs Replacement</option>
                            </select>
                            <label for="overallConditionComment" class="visually-hidden">Overall Room Condition Comments</label>
                            <textarea id="overallConditionComment" name="overallConditionComment" rows="2" placeholder="Optional comments for overall room condition..."></textarea>
                        </div>
                    </section>

                    <div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
                        <button type="submit" id="saveRoomBtn" class="action-button primary-button" style="flex-grow: 1;"><i class="fas fa-save"></i> Save Room Information</button>
                        <button type="button" id="copyCurrentRoomJsonBtn" class="action-button secondary-button" style="flex-grow: 1;"><i class="fas fa-copy"></i> Copy Room Data (JSON)</button>
                        <button type="button" id="cancelEditBtn" class="action-button danger-button" style="display:none; flex-grow: 1;"><i class="fas fa-times"></i> Cancel Edit</button>
                    </div>
                    <p id="feedbackMessage" class="feedback"></p>
                </form>
            </div>

            <div id="ViewRoomsView" class="view-section active-view">
                <header class="view-header">
                    <h1><i class="fas fa-eye"></i> View Saved Rooms</h1>
                </header>
                <div id="roomListContainer">
                    </div>
            </div>

            <div id="FilterView" class="view-section">
                <header class="view-header">
                    <h1><i class="fas fa-search"></i> Filter Room Data</h1>
                </header>
                <form id="filterForm" class="form-section">
                    <div class="input-group">
                        <label for="filterBuildingName">Building Name:</label>
                        <select id="filterBuildingName" name="filterBuildingName">
                            <option value="">-- Any Building --</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="filterRoomIdentifier">Room Identifier (Starts with):</label>
                        <input type="text" id="filterRoomIdentifier" name="filterRoomIdentifier" placeholder="e.g., 2 for 2nd floor rooms">
                    </div>
                    <div class="input-group">
                        <label for="globalQuery">Global Search:</label>
                        <input type="text" id="globalQuery" name="globalQuery" placeholder='e.g., poor AND tile OR (purpose:Lab AND "broken tiles")'>
                        <small>Use AND, OR, NOT, (), "exact phrases", and targeted searches like `purpose:Lab` or `floorcondition:Poor`.</small>
                    </div>

                    <button type="submit" id="applyFilterBtn" class="action-button primary-button"><i class="fas fa-filter"></i> Apply Filters</button>
                    <button type="button" id="clearFilterBtn" class="action-button secondary-button"><i class="fas fa-undo"></i> Clear Filters</button>
                    <p id="filterFeedback" class="feedback"></p>
                </form>
                <div id="filterResultsContainer">
                    </div>
            </div>

            <div id="AdminView" class="view-section">
                <header class="view-header">
                    <h1><i class="fas fa-user-shield"></i> Admin Panel: Pending Approvals</h1>
                </header>
                <div id="pendingUsersContainer">
                    </div>
                <p id="adminFeedback" class="feedback"></p>
            </div>

            <div id="DataView" class="view-section">
                <header class="view-header">
                    <h1><i class="fas fa-cogs"></i> Data Management</h1>
                </header>

                <section class="form-section data-management-section">
                    <h2><i class="fas fa-building-user"></i> Manage Buildings</h2>
                    <p class="data-management-description">Add new buildings or rename existing ones. Renaming a building here will update it for all associated rooms.</p>
                    <div class="import-method-container">
                        <h3 class="data-sub-heading"><i class="fas fa-plus-square"></i> Add New Building</h3>
                        <div class="input-group">
                            <label for="newBuildingNameInput">New Building Name:</label>
                            <input type="text" id="newBuildingNameInput" name="newBuildingNameInput" placeholder="Enter name for the new building">
                        </div>
                        <button id="addBuildingBtn" class="action-button primary-button"><i class="fas fa-plus"></i> Add Building</button>
                    </div>
                    <hr class="data-section-divider">
                    <div class="import-method-container">
                        <h3 class="data-sub-heading"><i class="fas fa-edit"></i> Rename Existing Building</h3>
                        <div class="input-group">
                            <label for="renameOldBuildingNameSelect">Select Building to Rename:</label>
                            <select id="renameOldBuildingNameSelect" name="renameOldBuildingNameSelect">
                                <option value="">-- Select Building --</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="renameNewBuildingNameInput">New Name for Building:</label>
                            <input type="text" id="renameNewBuildingNameInput" name="renameNewBuildingNameInput" placeholder="Enter the new name">
                        </div>
                        <button id="renameBuildingBtn" class="action-button secondary-button"><i class="fas fa-save"></i> Rename Building</button>
                    </div>
                    <p id="buildingManagementFeedback" class="feedback"></p>
                </section>

                <section class="form-section data-management-section">
                    <h2><i class="fas fa-file-import"></i> Import Room Data</h2>
                    <p class="data-management-description">Import rooms from a JSON or TXT file (containing JSON data) or by pasting JSON text. Duplicates will be flagged for resolution.</p>
                    <div class="import-method-container">
                        <h3 class="data-sub-heading"><i class="fas fa-upload"></i> Option 1: Import from File</h3>
                        <div class="input-group">
                            <label for="jsonImportFile">Select JSON or TXT File:</label>
                            <input type="file" id="jsonImportFile" name="jsonImportFile" accept=".json,.txt">
                        </div>
                        <button id="importJsonFileBtn" class="action-button primary-button"><i class="fas fa-file-upload"></i> Import from File</button>
                    </div>
                    <hr class="data-section-divider">
                    <div class="import-method-container">
                        <h3 class="data-sub-heading"><i class="fas fa-paste"></i> Option 2: Paste JSON Content</h3>
                        <div class="input-group">
                            <label for="jsonPasteArea">Paste JSON array here:</label>
                            <textarea id="jsonPasteArea" name="jsonPasteArea" rows="8" placeholder="[ { &quot;buildingName&quot;: &quot;Example Hall&quot;, &quot;roomIdentifier&quot;: &quot;101&quot;, ... }, ... ]"></textarea>
                        </div>
                        <button id="importJsonPasteBtn" class="action-button primary-button"><i class="fas fa-check-circle"></i> Import from Text</button>
                    </div>
                     <p id="importFeedback" class="feedback" style="margin-top:20px;"></p>
                </section>

                <section class="form-section data-management-section">
                    <h2><i class="fas fa-exchange-alt"></i> Mass Update Building Names (Room Data)</h2>
                    <p class="data-management-description">This utility reassigns rooms from an old building name to a new one. If you want to globally rename a building (which also updates rooms), use the "Manage Buildings" section above.</p>
                    <div class="input-group">
                        <label for="massUpdateOldBuildingNameSelect">Select Current Building Name (from Room Data):</label>
                        <select id="massUpdateOldBuildingNameSelect" name="massUpdateOldBuildingNameSelect">
                             <option value="">-- Select Building to Reassign From --</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="massUpdateNewBuildingNameInput">New Building Name (for these Rooms):</label>
                        <input type="text" id="massUpdateNewBuildingNameInput" name="massUpdateNewBuildingNameInput" placeholder="Enter the new building name for rooms">
                    </div>
                    <button id="massUpdateBuildingNameBtn" class="action-button secondary-button"><i class="fas fa-edit"></i> Update Rooms to New Building</button>
                    <p id="massUpdateFeedback" class="feedback"></p>
                </section>

                <section class="form-section data-management-section">
                    <h2><i class="fas fa-file-export"></i> Export All Room Data</h2>
                     <p class="data-management-description">All saved room information can be exported as a JSON file or copied to your clipboard.</p>
                    <textarea id="jsonDisplayArea" readonly aria-label="JSON data of all rooms"></textarea>
                    <div class="export-buttons-wrapper">
                        <button id="copyJsonBtn" class="action-button secondary-button"><i class="fas fa-copy"></i> Copy JSON</button>
                        <button id="exportAllBtn" class="action-button primary-button"><i class="fas fa-file-download"></i> Download JSON File</button>
                    </div>
                    <p id="exportFeedback" class="feedback"></p>
                </section>
            </div> 
            
            <div id="duplicateResolutionView" class="view-section">
                <header class="view-header">
                    <h1 style="color: var(--accent-color);"><i class="fas fa-exclamation-triangle"></i> Action Required: Room Conflict</h1>
                </header>
                <p class="data-management-description" style="text-align: center; font-size: 1.1rem;">
                    <strong>STOP:</strong> A room with this Building Name and Room ID already exists.
                    <br>
                    To prevent accidentally overwriting data, please review both sets of information below and choose an action.
                </p>
                
                <div class="conflict-resolution-container">
                    <div id="attemptedDataPanel" class="conflict-panel">
                        <h3><i class="fas fa-file-alt"></i> Your Unsaved Data</h3>
                        <div id="attemptedDataPreview" class="room-details-preview">
                        </div>
                        <div class="actions" style="margin-top: 15px;">
                            <button type="button" id="editAttemptedBtn" class="action-button primary-button"><i class="fas fa-edit"></i> Continue Editing</button>
                            <button type="button" id="discardAttemptedBtn" class="action-button secondary-button"><i class="fas fa-times-circle"></i> Discard This Data</button>
                        </div>
                    </div>
            
                    <div id="existingDataPanel" class="conflict-panel">
                        <h3><i class="fas fa-database"></i> Existing Saved Room</h3>
                        <div id="existingDataPreview" class="room-details-preview">
                        </div>
                        <div class="actions" style="margin-top: 15px;">
                            <button type="button" id="editExistingConflictBtn" class="action-button primary-button"><i class="fas fa-edit"></i> Edit Existing Room</button>
                            <button type="button" id="deleteExistingConflictBtn" class="action-button danger-button"><i class="fas fa-trash-alt"></i> Delete & Replace</button>
                        </div>
                    </div>
                </div>
                <p id="duplicateResolutionFeedback" class="feedback"></p>
                <div style="text-align: center; margin-top: 25px;">
                    <button type="button" id="cancelDuplicateResolutionBtn" class="action-button"><i class="fas fa-arrow-left"></i> Back to Main Room List</button>
                </div>
            </div>


        </main>
    </div> <div id="roomDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" role="button" tabindex="0" aria-label="Close room details">&times;</span>
            <h2>Room Details</h2>
            <div id="roomDetailContent">
            </div>
        </div>
    </div>

    <div id="conflictModal" class="modal">
        <div class="modal-content" style="max-width: 750px;">
            <span id="closeConflictModalBtn" class="close-modal-btn" role="button" tabindex="0" aria-label="Close conflict resolution">&times;</span>
            <h2 style="color: var(--accent-color);"><i class="fas fa-exclamation-triangle"></i> Import Conflict Detected</h2>
            <div id="conflictDetails" style="margin-bottom: 15px;">
                <p>An imported room has the same <strong>Building Name</strong> and <strong>Room Identifier</strong> as an existing room.</p>
                <div class="conflict-room-comparison">
                    <div class="conflict-room-panel">
                        <h4><i class="fas fa-file-import"></i> Importing Room Data:</h4>
                        <div id="importingRoomDetailsPreview" class="room-details-preview">
                        </div>
                    </div>
                    <div class="conflict-room-panel">
                        <h4><i class="fas fa-database"></i> Existing Room Data:</h4>
                        <div id="existingRoomDetailsPreview" class="room-details-preview">
                        </div>
                    </div>
                </div>
            </div>
            <p><strong>How would you like to resolve this?</strong></p>
            <div class="form-section" style="padding:15px; margin-top:10px; border-color: var(--accent-color);">
                <h4 style="margin-bottom:10px; color: var(--primary-color);">Option 1: Modify Importing Room's Identifiers & Save</h4>
                <div class="input-group">
                    <label for="conflictBuildingNew">New Building Name for Importing Room:</label>
                    <input type="text" id="conflictBuildingNew" name="conflictBuildingNew">
                </div>
                <div class="input-group">
                    <label for="conflictRoomIDNew">New Room Identifier for Importing Room:</label>
                    <input type="text" id="conflictRoomIDNew" name="conflictRoomIDNew">
                </div>
                 <button id="saveModifiedConflictBtn" class="action-button primary-button" style="margin-top:5px;"><i class="fas fa-save"></i> Import with These Modifications</button>
                 <p id="modifyConflictFeedback" class="feedback" style="font-size:0.85rem; padding:8px;"></p>
            </div>

            <div class="conflict-actions" style="text-align: center; margin-top: 20px; display:flex; justify-content:space-around; flex-wrap:wrap; gap:10px;">
                <button id="replaceConflictBtn" class="action-button secondary-button"><i class="fas fa-sync-alt"></i> Option 2: Replace Existing Room</button>
                <button id="skipConflictBtn" class="action-button danger-button"><i class="fas fa-forward"></i> Option 3: Skip This Importing Room</button>
                <button id="massReplaceAllConflictBtn" class="action-button" style="background-color: var(--success-color); color: white; order: 1; /* Puts it visually first in flex row if desired */"><i class="fas fa-check-double"></i> Mass Replace All Subsequent</button>
                <button id="massSkipAllConflictBtn" class="action-button" style="background-color: var(--accent-color); color: white; order: 2;"><i class="fas fa-ban"></i> Mass Skip All Subsequent</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBszCM6d9KZ9sLRfs7DGvZVCuOq0xRFiVs",
            authDomain: "roomfolio-89ea1.firebaseapp.com",
            projectId: "roomfolio-89ea1",
            storageBucket: "roomfolio-89ea1.appspot.com",
            messagingSenderId: "974728166698",
            appId: "1:974728166698:web:e6c86d61ab1b69002ff253",
            measurementId: "G-YRTDM72M6Z"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        // Make the app instance available globally for your script.js
        window.firebaseApp = app;
    </script>

    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    
    <script src="script.js" type="module"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          // This script handles the "Other" checkbox behavior for specialty/other text inputs
          // in furniture and technology sections, and for "Other Fixture" details.
          const otherCheckboxes = document.querySelectorAll(".other-checkbox");
          otherCheckboxes.forEach(checkbox => {
            checkbox.addEventListener("change", function () {
              const container = checkbox.closest(".other-field-wrapper, .fixture-item-group-other");
              if (!container) return;

              const textInput = container.querySelector("input[type='text'].conditional-other, input[type='text'][name$='Specify']");
              
              if (checkbox.checked) {
                if (textInput) {
                  textInput.style.display = textInput.classList.contains('inline-other') ? "inline-block" : "block";
                }
                // Special handling for the "Other Fixture" group which has a details container
                if (container.classList.contains('fixture-item-group-other')) {
                    const detailsContainer = container.querySelector('.other-details-container');
                    if (detailsContainer) detailsContainer.style.display = 'flex';
                }

              } else {
                if (textInput) {
                  textInput.style.display = "none";
                  textInput.value = "";
                }
                if (container.classList.contains('fixture-item-group-other')) {
                    const detailsContainer = container.querySelector('.other-details-container');
                    if (detailsContainer) {
                        detailsContainer.style.display = 'none';
                        // Also clear inputs within the details container
                        const innerTextInput = detailsContainer.querySelector("input[type='text']");
                        const innerQtyInput = detailsContainer.querySelector("input[type='number']");
                        if(innerTextInput) innerTextInput.value = "";
                        if(innerQtyInput) innerQtyInput.value = "";
                    }
                }
              }
            });
          });
        });
      </script>
      <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/Roomfolio/service-worker.js') // Ensure this path is correct for your deployment
              .then((registration) => {
                console.log('Service Worker registered with scope:', registration.scope);
              })
              .catch((error) => {
                console.error('Service Worker registration failed:', error);
              });
          });
        }
    </script>
</body>
</html>